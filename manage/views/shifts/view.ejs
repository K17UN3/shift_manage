<!DOCTYPE html>
<html>
<head>
    <title>全体シフト確認</title>
</head>
<body>
    <h1>全体シフト確認 (<%= currentMonth.format('YYYY年MM月') %>)</h1>
    <p><a href="/shifts/home">ホームに戻る</a></p>

    <h2>社員別合計勤務時間 (基準: 160時間)</h2>
    <div class="summary-container">
    <% Object.entries(totalHoursMap).forEach(([username, totalHours]) => { %>
        <%
            const isHigh = parseFloat(totalHours) >= 160;
            // EJS内で幅を計算
            const widthPercent = Math.min(100, (totalHours / 160) * 100);
        %>
        <p>
            <span <% if (isHigh) { %>style="color: red; font-weight: bold;"<% } %>><%= username %>: <%= totalHours %>時間</span>
            
            <div>
                <%= username %>
            </div>
        </p>
    <% }); %>
    </div>

    <hr>

    <h2>日付別シフト詳細</h2>
    <% for (let i = 0; i < currentMonth.daysInMonth(); i++) { %>
        <% const date = currentMonth.clone().add(i, 'days').format('YYYY-MM-DD'); %>
        <h3><%= currentMonth.clone().add(i, 'days').format('MM月DD日 (ddd)') %></h3>
        <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
        <% if (shiftsByDay[date] && shiftsByDay[date].length > 0) { %>
            <ul>
            <% shiftsByDay[date].forEach(shift => { %>
                <li><%= shift.username %>: <%= shift.start_time %> - <%= shift.end_time %> (<%= shift.duration.toFixed(1) %>h)</li>
            <% }); %>
            </ul>
        <% } else { %>
            <p>シフト提出なし</p>
        <% } %>
        </div>
    <% } %>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>„Ç∑„Éï„ÉàÁÆ°ÁêÜ„ÉªÁôªÈå≤</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        h1 { font-size: 1.4rem; border-left: 5px solid #007bff; padding-left: 15px; margin: 0; }
        .form-section { background: #f8f9fa; padding: 20px; border-radius: 10px; border: 1px solid #eef0f2; margin-bottom: 30px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-weight: bold; font-size: 0.85rem; margin-bottom: 5px; color: #555; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .btn-submit { width: 100%; background: #007bff; color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .shift-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .shift-table th, .shift-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .time-badge { background: #e7f5ff; color: #1971c2; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; font-weight: bold; }
        .error-msg { background: #fff5f5; color: #e03131; padding: 15px; border-radius: 8px; border: 1px solid #ffc9c9; margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header-area">
        <h1><%= isAdmin ? 'ÁÆ°ÁêÜËÄÖÁî®„Ç∑„Éï„ÉàÁÆ°ÁêÜ' : '„Ç∑„Éï„ÉàÁôªÈå≤' %></h1>
        <a href="/shifts/home" style="text-decoration:none; color:#007bff; font-weight:bold;">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</a>
    </div>

    <% if (error) { %>
        <div class="error-msg"><strong>‚ö†Ô∏è „Ç®„É©„Éº:</strong> <%= error %></div>
    <% } %>

    <div class="form-section">
        <form action="/shifts/register" method="POST">
            <div class="form-grid">
                <div>
                    <label>„Çπ„Çø„ÉÉ„Éï</label>
                    <% if (isAdmin) { %>
                        <select name="employee_id" required>
                            <% if (username !== 'admin') { %>
                                <option value="<%= userId %>">Ëá™ÂàÜ (<%= username %>)</option>
                            <% } %>

                            <% allUsers.forEach(user => { %>
                                <% if (user.id != userId && user.username !== 'admin') { %>
                                    <option value="<%= user.id %>"><%= user.username %></option>
                                <% } %>
                            <% }); %>
                        </select>
                    <% } else { %>
                        <input type="text" value="<%= username %>" disabled>
                        <input type="hidden" name="employee_id" value="<%= userId %>">
                    <% } %>
                </div>
                <div>
                    <label>Êó•‰ªò</label>
                    <input type="date" name="date" required value="<%= moment().format('YYYY-MM-DD') %>">
                </div>
                <div style="display: flex; gap: 10px;">
                    <div style="flex:1">
                        <label>ÈñãÂßã</label>
                        <input type="time" name="start" required value="09:00">
                    </div>
                    <div style="flex:1">
                        <label>ÁµÇ‰∫Ü</label>
                        <input type="time" name="end" required value="17:00">
                    </div>
                </div>
            </div>
            <button type="submit" class="btn-submit">ÁôªÈå≤„Åô„Çã</button>
        </form>
    </div>

    <h2>üìÖ ‰ªäÊúà„ÅÆ„Ç∑„Éï„Éà‰∏ÄË¶ß (ÂêàË®à: <%= currentHours %>h)</h2>
    <table class="shift-table">
        <thead>
            <tr>
                <th>„Çπ„Çø„ÉÉ„Éï</th>
                <th>Êó•‰ªò</th>
                <th>ÊôÇÈñì</th>
                <% if (isAdmin) { %><th>Êìç‰Ωú</th><% } %>
            </tr>
        </thead>
        <tbody>
            <% registeredShifts.forEach(shift => { %>
                <tr>
                    <td>
                        <strong><%= shift.username %></strong>
                        <br><small style="color: #666;"><%= shift.user_role %></small>
                    </td>
                    <td><%= shift.shift_date %></td>
                    <td><span class="time-badge"><%= shift.start_time %> - <%= shift.end_time %></span></td>
                    <% if (isAdmin) { %>
                        <td>
                            <form action="/shifts/delete/<%= shift.id %>" method="POST" style="margin:0;" onsubmit="return confirm('ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü');">
                                <button type="submit" style="background:none; border:none; color:#e03131; cursor:pointer; text-decoration:underline; font-size:0.8rem;">ÂâäÈô§</button>
                            </form>
                        </td>
                    <% } %>
                </tr>
            <% }); %>
        </tbody>
    </table>
</div>
</body>
</html>